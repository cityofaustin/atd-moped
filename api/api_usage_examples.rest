# This file contains example HTTP calls and it also the configuration
# file for the VSCode plugin "REST Client" https://open-vsx.org/extension/humao/rest-client. 

@API_SERVER = http://localhost:5001/
#@API_SERVER = https://moped-user-file-api-staging.austinmobility.io/

# Bearer Token starts with 'ey...', no quotes
@AUTH_BEARER_TOKEN = eyJraWQiOiJqVXltd2JzdFJFa1MwK2lEcjJoelk2amRHZFV5blA5TDFLeFVwa0Z4UXpBPSIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiJhZWFlYjk2Zi02ZjY5LTRiOTUtYTI3Mi05NTY0NDUxODljNTQiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwiaHR0cHM6XC9cL2hhc3VyYS5pb1wvand0XC9jbGFpbXMiOiJ7XCJ4LWhhc3VyYS11c2VyLWlkXCI6IFwiYWVhZWI5NmYtNmY2OS00Yjk1LWEyNzItOTU2NDQ1MTg5YzU0XCIsIFwieC1oYXN1cmEtZGVmYXVsdC1yb2xlXCI6IFwibW9wZWQtdmlld2VyXCIsIFwieC1oYXN1cmEtYWxsb3dlZC1yb2xlc1wiOiBbXCJtb3BlZC1hZG1pblwiXSwgXCJ4LWhhc3VyYS11c2VyLWRiLWlkXCI6IFwiNjhcIiwgXCJ4LWhhc3VyYS11c2VyLXdnLWlkXCI6IFwiM1wifSIsImlzcyI6Imh0dHBzOlwvXC9jb2duaXRvLWlkcC51cy1lYXN0LTEuYW1hem9uYXdzLmNvbVwvdXMtZWFzdC0xX1UyZHpreGZUdiIsImNvZ25pdG86dXNlcm5hbWUiOiJhZWFlYjk2Zi02ZjY5LTRiOTUtYTI3Mi05NTY0NDUxODljNTQiLCJhdWQiOiIzdTluOTM3M2UzN3Y2MDN0YnAyNWdzNWZkYyIsImV2ZW50X2lkIjoiOTY5ZDcwYTktN2VmMS00MTlkLWFmODgtM2RmOGRiMjA0OWJlIiwidG9rZW5fdXNlIjoiaWQiLCJhdXRoX3RpbWUiOjE3NTMyODY3NjAsImV4cCI6MTc1Mzc2MzAzMCwiaWF0IjoxNzUzNzE5ODM1LCJlbWFpbCI6ImZyYW5rLmhlcmVmb3JkQGF1c3RpbnRleGFzLmdvdiJ9.N1rgMB_Bhf3zcBJ4Uy_uQNJ4ItLp64oXjU_0pbZdqm4_vtTbL400GduZEpgkDfgP2cN3jDD3kZMITF7ROHhTxofoJiyWho591LRYGGParIx8cU09mryHqTx-SbhfX1QZv0fryRyAEVybDlA79Okb16uAOMaAM62zdfdbg2RsQWPMoHY-ZtjNGyQlGEKFrCzIuxVeWw-jXVKqB2TAq4gOH9VQaeRj8AAziikixibywVaKYSv6HteNg-UPpOKNv1QAxR5uYA1oewN0LNavFObECg4a2m6185Gynm0rA13_ovl-c75Efra7CpgJhcBJNDfBbDnjSP9-ARn2UYG0gQwxdw



# Health Check
{{API_SERVER}}

# ------------------------------------------------------------------------------
# Auth Endpoint
# ------------------------------------------------------------------------------

### Auth Health Check
# Returns a health check message for the auth endpoint.
{{API_SERVER}}/auth/

### auth_current_user()
# Current User. You can get the AUTH_BEARER_TOKEN from the browser's console by looking at 
# a request to graphql-engine. It is only as long-lived as your browser session.
# Returns the current user's Cognito username, email, Hasura claims, and the full decrypted JWT.
{{API_SERVER}}/auth/current_user
Authorization: Bearer {{AUTH_BEARER_TOKEN}}

### auth_current_user2()
# Similar to /auth/current_user, but uses the @normalize_claims decorator to provide a 
# parsed dictionary of claims. 
# Returns the user's Cognito username, email, and Hasura claims.

{{API_SERVER}}/auth/current_user2
Authorization: Bearer {{AUTH_BEARER_TOKEN}}


### soemthindg something

# ------------------------------------------------------------------------------
# Users Endpoint
# ------------------------------------------------------------------------------

# This can be found via the `/users/` endpoint

@USER_ID = aeaeb96f-6f69-4b95-a272-956445189c54

### Users listing
# Lists all users in the Cognito user pool, excluding those with usernames
# starting with 'azuread_'. Requires a valid user session.
{{API_SERVER}}/users/
Authorization: Bearer {{AUTH_BEARER_TOKEN}}

### user_get_user()
# Returns detailed information for a specific user, including Cognito user info 
# and their Hasura roles. 
# The USER_ID is the Cognito user ID ("Username" from the user list endpoint). 
# Requires a valid user session.
{{API_SERVER}}/users/{{USER_ID}}
Authorization: Bearer {{AUTH_BEARER_TOKEN}}

### user_create_user()
# Creates a new user. Requires moped-admin role.
# The password must be at least 12 characters and contain at least one uppercase letter,
# one lowercase letter, one number, and one special character.
POST {{API_SERVER}}/users/
Authorization: Bearer {{AUTH_BEARER_TOKEN}}
Content-Type: application/json

{
    "email": "test.user2@austintexas.gov",
    "first_name": "FirstName",
    "last_name": "LastName",
    "is_coa_staff": true,
    "title": "This is a job title",
    "workgroup_id": 1,
    "password": "c3st-ne-p@s-un-MOT-de-passe",
    "roles": [
        "moped-viewer"
    ],
    "is_user_group_member": false,
    "note": "Optional note."
}

### user_update_user()
# Updates a user. Requires moped-admin role. The USER_ID is the Cognito user ID.
# The payload is similar to the create user payload.
# A password is not required unless you want to change it.
#This hardcoded value is a test user created in our staging environment


PUT {{API_SERVER}}/users/{{USER_ID}}
Authorization: Bearer {{AUTH_BEARER_TOKEN}}
Content-Type: application/json

{
    "email": "test.user2@austintexas.gov",
    "first_name": "UpdatedFirstName",
    "last_name": "UpdatedLastName",
    "is_coa_staff": true,
    "title": "This is an updated job title",
    "workgroup_id": 1,
    "roles": [
        "moped-editor"
    ],
    "is_user_group_member": true,
    "note": "This is an updated note."
}

### user_activate_user()
# Activates a user that exists in the database but not in Cognito.
# Requires moped-admin role.
PUT {{API_SERVER}}/users/activate/
Authorization: Bearer {{AUTH_BEARER_TOKEN}}
Content-Type: application/json

{
    "email": "some.user.in.the.database@austintexas.gov",
    "password": "c3st-ne-p@s-un-MOT-de-passe",
    "roles": ["moped-viewer"]
}

### user_delete_user()
# Deletes a user from Cognito and deactivates them in the Moped database.
# The USER_ID is the Cognito user ID. Requires moped-admin role.
DELETE {{API_SERVER}}/users/{{USER_ID}}
Authorization: Bearer {{AUTH_BEARER_TOKEN}}


# ------------------------------------------------------------------------------
# Files Endpoint
# ------------------------------------------------------------------------------


### Files Health Check
{{API_SERVER}}/files/


### files_request_signature() for a project
# Requests a pre-signed URL to upload a file to S3 for a specific project.
# The file name should be a valid file name.
# The project_id associates the file with a project.
# The type is optional, it can be 'private' or 'public'. Defaults to 'private'.
{{API_SERVER}}/files/request-signature?file=test-project-file.jpg&project_id=1&type=public
Authorization: Bearer {{AUTH_BEARER_TOKEN}}

### files_request_signature() for a user
# Requests a pre-signed URL to upload a file to S3 associated with the user.
# The file name should be a valid file name.
# No project_id is provided.
{{API_SERVER}}/files/request-signature?file=test-user-file.png&type=private
Authorization: Bearer {{AUTH_BEARER_TOKEN}}

### file_download()
# Retrieves a pre-signed URL to download a file from S3.
# The path is the S3 key of the file.
# This path is returned from the files_request_signature endpoint in the `filename` field.
# You would need to replace {{FILE_S3_KEY}} with a real file key from a previous request.
# Example path: private/user/1/some-file.txt
@FILE_S3_KEY = private/city-of-austin-logo.png
GET {{API_SERVER}}/files/download/{{FILE_S3_KEY}}
Authorization: Bearer {{AUTH_BEARER_TOKEN}}
